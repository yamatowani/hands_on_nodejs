## プロセスとスレッドの違い
### プロセス
- 実行中のプログラムのインスタンス
- OS上で**独立**して動作し、独自のリソース(cpu時間, メモリ, ファイルディスクリプタ)とメモリ空間を持つ
  - 一つのプロセスがクラッシュしても他のプロセスには影響しない
- プロセスは親プロセスから生成される, UNIX系統のOSでは`fork`システムコールで生成される
- ex: ブラウザのタブがそれぞれ独立したプロセスとして動作する
### スレッド
- **プロセス内で実行される最小単位のタスク**
- 同じプロセス内のスレッドは相互に影響し合う
- ex: ゲーム内でのキャラクターの動き, サウンド再生, ネットワーク通信などがそれぞれ別スレッドとして処理される

## イベントループ(シングルスレッド)とマルチスレッドの違い
イベントループとマルチスレッドは、非同期処理や並行処理を実現するための異なるアプローチのこと
### シングルスレッドによるイベントループ
単一のスレッドで非同期処理を効率的に管理する仕組みのこと
主に、待ち時間が発生するI/O操作(ex: ファイル操作, ネットワーク通信, DB操作)を非同期で処理をする
- メインスレッドがタスクを順に処理する
- ブロッキング操作 (待機が必要な処理) を回避するため、非同期的に処理を委任
- メリット: 並行処理をコードで柔軟で制御でき、スレッドセーフへの配慮がいらない
- デメリット: 並行処理を記述するのに非同期プログラミングが必要になる, 制御フローが複雑になりやすい
- pros: スレッド管理のオーバーヘッドがな句、スレッド間の同期問題が発生しない
- cons: メインスレッドが重い処理でブロックされると全体が停止してしまう
### node.jsによるhttpサーバー実装例
Node.jsではシングルスレッドで動作する, 非同期I/O処理をイベントループと非同期コールバックで効率的に処理をする
```javascript
const http = require('http');
const server = http.createServer((req, res) => {
  if(req.url === '/slow') {
    setTimeout(() => {
      res.end('Slow Response');
    }, 5000)
  } else {
    res.end('Fast Response');
  }
});
server.listen(3000, () => {
  console.log('Server running on http://localhost:3000');
});
```
- setTimeoutで非同期タスクをスケジューリング
  - `setTimeout(callback, delay, ...args);`
    - callback関数, タスクをスケジューリングするまでの遅延時間, 追加の引数(任意)
    1. callback関数がタイマー付きでイベントループに登録される
    2. 遅延時間が経過するとcallback関数がイベントキューに追加される
    3. イベントループが空いているタイミングで、キューにあるタスクが処理される
- イベントループが他のリクエストを処理中でも、スロータスクの完了を待機する
- 高速な応答は遅延なく処理される
### マルチスレッド
複数のスレッドを使って平行処理を行う手法, 各スレッドは独立して動き、同じメモリ空間を共有する
- 同時に複数のタスクを処理可能でCPUコアを最大限活用できる
- メリット: 並行処理をコードで表現する必要がないため、多くの場合並行処理を簡潔に記述できる
- デメリット: 並行処理をコードから制御する難易度が高く、一部のユースケースを実現するためには逆にめっちゃ複雑な実装が必要になる
- pros: 並列性を利用して高パフォーマンスを実現
- cons: スレッドの管理コストが高い
### Ruby on Railsでのマルチスレッド実装例
Railsはデフォルトでリクエストごとにスレッドを生成して処理を行う
```ruby
class ApplicationController < ActionController::Base
  def slow_req
    sleep(5) # 時間がかかる処理
    render plain: "Slow Response"
  end

  def fast_req
    render plain: "Fast Response"
  end
end
```
- 各リクエストはスレッドプール内の空いているスレッドで処理される
- 1つのスレッドがスリープ中でも他のスレッドが並行してリクエストを処理できる
